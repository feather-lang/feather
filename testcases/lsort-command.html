<test-suite name="lsort -command option">

<test-case name="lsort -command basic numeric">
  <script>
    proc numcmp {a b} {
        expr {$a - $b}
    }
    lsort -command numcmp {3 1 4 1 5 9 2 6}
  </script>
  <return>TCL_OK</return>
  <stdout>1 1 2 3 4 5 6 9</stdout>
</test-case>

<test-case name="lsort -command reverse">
  <script>
    proc revcmp {a b} {
        expr {$b - $a}
    }
    lsort -command revcmp {3 1 4 1 5}
  </script>
  <return>TCL_OK</return>
  <stdout>5 4 3 1 1</stdout>
</test-case>

<test-case name="lsort -command by length">
  <script>
    proc lencmp {a b} {
        expr {[string length $a] - [string length $b]}
    }
    lsort -command lencmp {cat elephant dog mouse}
  </script>
  <return>TCL_OK</return>
  <stdout>cat dog mouse elephant</stdout>
</test-case>

<test-case name="lsort -command with -unique">
  <script>
    proc numcmp {a b} {
        expr {$a - $b}
    }
    lsort -command numcmp -unique {3 1 2 1 3}
  </script>
  <return>TCL_OK</return>
  <stdout>1 2 3</stdout>
</test-case>

<test-case name="lsort -command with -decreasing">
  <script>
    proc numcmp {a b} {
        expr {$a - $b}
    }
    lsort -command numcmp -decreasing {3 1 2}
  </script>
  <return>TCL_OK</return>
  <stdout>3 2 1</stdout>
</test-case>

<test-case name="lsort -command with -index">
  <script>
    proc numcmp {a b} {
        expr {$a - $b}
    }
    lsort -command numcmp -index 1 {{a 3} {b 1} {c 2}}
  </script>
  <return>TCL_OK</return>
  <stdout>{b 1} {c 2} {a 3}</stdout>
</test-case>

<test-case name="lsort -command nonexistent proc">
  <script>
    lsort -command nonexistent {a b c}
  </script>
  <return>TCL_ERROR</return>
  <error>invalid command name "nonexistent"</error>
  <exit-code>1</exit-code>
</test-case>

<test-case name="lsort -command non-integer result">
  <script>
    proc badcmp {a b} {
        return "not a number"
    }
    lsort -command badcmp {a b}
  </script>
  <return>TCL_ERROR</return>
  <error>-compare command returned non-integer result</error>
  <exit-code>1</exit-code>
</test-case>

<test-case name="lsort -command error in proc">
  <script>
    proc errorcmp {a b} {
        error "comparison failed"
    }
    lsort -command errorcmp {a b}
  </script>
  <return>TCL_ERROR</return>
  <error>comparison failed</error>
  <exit-code>1</exit-code>
</test-case>

<test-case name="lsort -command empty list">
  <script>
    proc numcmp {a b} {
        expr {$a - $b}
    }
    lsort -command numcmp {}
  </script>
  <return>TCL_OK</return>
  <stdout></stdout>
</test-case>

<test-case name="lsort -command single element">
  <script>
    proc numcmp {a b} {
        expr {$a - $b}
    }
    lsort -command numcmp {42}
  </script>
  <return>TCL_OK</return>
  <stdout>42</stdout>
</test-case>

<test-case name="lsort -command missing argument">
  <script>
    lsort -command {a b c}
  </script>
  <return>TCL_ERROR</return>
  <error>"-command" option must be followed by comparison command</error>
  <exit-code>1</exit-code>
</test-case>

</test-suite>
