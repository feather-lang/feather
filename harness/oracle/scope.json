{
  "feature": "scope",
  "tclsh": "tclsh",
  "tests": [
    {
      "name": "global-1.1",
      "file": "spec/tests/scope/global-1.1.tcl",
      "script": "# Test: global command - basic usage\nset x 100\nproc test {} {\n    global x\n    puts \"x = $x\"\n}\ntest\n",
      "stdout": "x = 100\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "global-1.2",
      "file": "spec/tests/scope/global-1.2.tcl",
      "script": "# Test: global command - modify global variable\nset x 100\nproc test {} {\n    global x\n    set x 200\n}\ntest\nputs \"x = $x\"\n",
      "stdout": "x = 200\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "global-1.3",
      "file": "spec/tests/scope/global-1.3.tcl",
      "script": "# Test: global command - multiple variables\nset a 1\nset b 2\nset c 3\nproc test {} {\n    global a b c\n    puts \"a=$a b=$b c=$c\"\n}\ntest\n",
      "stdout": "a=1 b=2 c=3\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "global-2.0",
      "file": "spec/tests/scope/global-2.0.tcl",
      "script": "# Test: global at top level has no effect\nglobal x\nset x 42\nputs \"x = $x\"\n",
      "stdout": "x = 42\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "global-2.1",
      "file": "spec/tests/scope/global-2.1.tcl",
      "script": "# Test: global creates variable that doesn't exist yet\nproc test {} {\n    global newvar\n    set newvar \"created\"\n}\ntest\nputs \"newvar = $newvar\"\n",
      "stdout": "newvar = created\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "global-2.2",
      "file": "spec/tests/scope/global-2.2.tcl",
      "script": "# Test: global variable modifications persist\nset counter 0\nproc increment {} {\n    global counter\n    incr counter\n}\nincrement\nincrement\nincrement\nputs \"counter = $counter\"\n",
      "stdout": "counter = 3\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "global-2.3",
      "file": "spec/tests/scope/global-2.3.tcl",
      "script": "# Test: global in nested proc\nset x 100\nproc outer {} {\n    proc inner {} {\n        global x\n        set x 999\n    }\n    inner\n}\nouter\nputs \"x = $x\"\n",
      "stdout": "x = 999\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "global-2.4",
      "file": "spec/tests/scope/global-2.4.tcl",
      "script": "# Test: global with no args returns empty\nproc test {} {\n    puts [global]\n}\ntest\n",
      "stdout": "\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-1.1",
      "file": "spec/tests/scope/uplevel-1.1.tcl",
      "script": "# Test: uplevel command - basic usage\nproc test {} {\n    set x 10\n    uplevel 1 {set y 20}\n}\ntest\nputs \"y = $y\"\n",
      "stdout": "y = 20\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-1.2",
      "file": "spec/tests/scope/uplevel-1.2.tcl",
      "script": "# Test: uplevel command - access caller's variables\nset x 100\nproc test {} {\n    uplevel 1 {puts \"x = $x\"}\n}\ntest\n",
      "stdout": "x = 100\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-1.3",
      "file": "spec/tests/scope/uplevel-1.3.tcl",
      "script": "# Test: uplevel command - level #0 refers to global\nproc test {} {\n    uplevel #0 {set result \"from global\"}\n}\ntest\nputs \"result = $result\"\n",
      "stdout": "result = from global\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-2.0",
      "file": "spec/tests/scope/uplevel-2.0.tcl",
      "script": "# Test: uplevel level 2 - skip one frame\nset x \"global\"\nproc outer {} {\n    set x \"outer\"\n    inner\n}\nproc inner {} {\n    uplevel 2 {puts \"x = $x\"}\n}\nouter\n",
      "stdout": "x = global\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-2.1",
      "file": "spec/tests/scope/uplevel-2.1.tcl",
      "script": "# Test: uplevel returns result of evaluated script\nproc test {} {\n    uplevel 1 {expr {2 + 3}}\n}\nputs \"result = [test]\"\n",
      "stdout": "result = 5\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-2.2",
      "file": "spec/tests/scope/uplevel-2.2.tcl",
      "script": "# Test: uplevel concatenates multiple args\nproc test {} {\n    set cmd \"puts\"\n    set arg \"hello\"\n    uplevel 1 $cmd $arg\n}\ntest\n",
      "stdout": "hello\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-2.3",
      "file": "spec/tests/scope/uplevel-2.3.tcl",
      "script": "# Test: uplevel #1 - absolute level\nset x \"global\"\nproc outer {} {\n    set x \"outer\"\n    inner\n}\nproc inner {} {\n    set x \"inner\"\n    uplevel #1 {puts \"x = $x\"}\n}\nouter\n",
      "stdout": "x = outer\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-2.4",
      "file": "spec/tests/scope/uplevel-2.4.tcl",
      "script": "# Test: uplevel for implementing control construct\nproc repeat {n body} {\n    for {set i 0} {$i \u003c $n} {incr i} {\n        uplevel 1 $body\n    }\n}\nset sum 0\nrepeat 5 {\n    incr sum\n}\nputs \"sum = $sum\"\n",
      "stdout": "sum = 5\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-2.5",
      "file": "spec/tests/scope/uplevel-2.5.tcl",
      "script": "# Test: uplevel 0 - execute in current frame\nproc test {} {\n    set x 10\n    uplevel 0 {set x 20}\n    puts \"x = $x\"\n}\ntest\n",
      "stdout": "x = 20\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "uplevel-2.6",
      "file": "spec/tests/scope/uplevel-2.6.tcl",
      "script": "# Test: nested uplevel calls\nproc level3 {} {\n    uplevel 1 {set z 30}\n}\nproc level2 {} {\n    set y 20\n    level3\n    uplevel 1 {set w 40}\n}\nproc level1 {} {\n    set x 10\n    level2\n}\nlevel1\nputs \"z = $z\"\nputs \"w = $w\"\n",
      "stdout": "",
      "stderr": "can't read \"z\": no such variable\n    while executing\n\"puts \"z = $z\"\"\n    (file \"spec/tests/scope/uplevel-2.6.tcl\" line 15)\n",
      "returncode": 1
    },
    {
      "name": "upvar-1.1",
      "file": "spec/tests/scope/upvar-1.1.tcl",
      "script": "# Test: upvar command - basic usage\nproc setvar {name value} {\n    upvar 1 $name var\n    set var $value\n}\nset x 0\nsetvar x 42\nputs \"x = $x\"\n",
      "stdout": "x = 42\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-1.2",
      "file": "spec/tests/scope/upvar-1.2.tcl",
      "script": "# Test: upvar command - default level is 1\nproc setvar {name value} {\n    upvar $name var\n    set var $value\n}\nset x 0\nsetvar x 99\nputs \"x = $x\"\n",
      "stdout": "x = 99\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-1.3",
      "file": "spec/tests/scope/upvar-1.3.tcl",
      "script": "# Test: upvar command - level #0 refers to global\nproc setglobal {name value} {\n    upvar #0 $name var\n    set var $value\n}\nset x 0\nsetglobal x 123\nputs \"x = $x\"\n",
      "stdout": "x = 123\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-2.0",
      "file": "spec/tests/scope/upvar-2.0.tcl",
      "script": "# Test: upvar multiple variable pairs\nproc swapvars {name1 name2} {\n    upvar 1 $name1 v1 $name2 v2\n    set temp $v1\n    set v1 $v2\n    set v2 $temp\n}\nset a \"first\"\nset b \"second\"\nswapvars a b\nputs \"a = $a\"\nputs \"b = $b\"\n",
      "stdout": "a = second\nb = first\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-2.1",
      "file": "spec/tests/scope/upvar-2.1.tcl",
      "script": "# Test: upvar level 2 - skip one frame\nset x \"global\"\nproc outer {} {\n    set x \"outer\"\n    inner\n}\nproc inner {name} {\n    upvar 2 $name var\n    set var \"modified\"\n}\nproc middle {} {\n    inner x\n}\nouter\nputs \"x = $x\"\n",
      "stdout": "",
      "stderr": "wrong # args: should be \"inner name\"\n    while executing\n\"inner\"\n    (procedure \"outer\" line 3)\n    invoked from within\n\"outer\"\n    (file \"spec/tests/scope/upvar-2.1.tcl\" line 14)\n",
      "returncode": 1
    },
    {
      "name": "upvar-2.2",
      "file": "spec/tests/scope/upvar-2.2.tcl",
      "script": "# Test: upvar creates non-existent variable\nproc createvar {name value} {\n    upvar 1 $name var\n    set var $value\n}\ncreatevar newvar \"hello\"\nputs \"newvar = $newvar\"\n",
      "stdout": "newvar = hello\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-2.3",
      "file": "spec/tests/scope/upvar-2.3.tcl",
      "script": "# Test: upvar with array element\nset arr(key) \"original\"\nproc modify {name} {\n    upvar 1 $name var\n    set var \"modified\"\n}\nmodify arr(key)\nputs \"arr(key) = $arr(key)\"\n",
      "stdout": "arr(key) = modified\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-2.4",
      "file": "spec/tests/scope/upvar-2.4.tcl",
      "script": "# Test: upvar #1 - absolute level\nset x \"global\"\nproc outer {} {\n    set x \"outer\"\n    inner\n}\nproc inner {} {\n    upvar #1 x var\n    puts \"var = $var\"\n}\nouter\n",
      "stdout": "var = outer\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-2.5",
      "file": "spec/tests/scope/upvar-2.5.tcl",
      "script": "# Test: upvar returns empty string\nproc test {name} {\n    set result [upvar 1 $name var]\n    puts \"upvar returned: '$result'\"\n}\nset x 10\ntest x\n",
      "stdout": "upvar returned: ''\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-2.6",
      "file": "spec/tests/scope/upvar-2.6.tcl",
      "script": "# Test: upvar - implement add2 from manual\nproc add2 {name} {\n    upvar $name x\n    set x [expr {$x + 2}]\n}\nset val 10\nadd2 val\nputs \"val = $val\"\n",
      "stdout": "val = 12\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "upvar-2.7",
      "file": "spec/tests/scope/upvar-2.7.tcl",
      "script": "# Test: upvar - implement decr from manual\nproc decr {varName {decrement 1}} {\n    upvar 1 $varName var\n    incr var [expr {-$decrement}]\n}\nset counter 10\ndecr counter\nputs \"counter = $counter\"\ndecr counter 3\nputs \"counter = $counter\"\n",
      "stdout": "counter = 9\ncounter = 6\n",
      "stderr": "",
      "returncode": 0
    }
  ]
}