{
  "feature": "event",
  "tclsh": "tclsh",
  "tests": [
    {
      "name": "after-1.0",
      "file": "spec/tests/event/after-1.0.tcl",
      "script": "# Test: after ms - blocking sleep (short delay to avoid long test)\n# This should block for 10ms then return empty string\nputs [after 10]\nputs \"done\"\n",
      "stdout": "\ndone\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-1.1",
      "file": "spec/tests/event/after-1.1.tcl",
      "script": "# Test: after 0 - zero delay should still work\nputs [after 0]\nputs \"done\"\n",
      "stdout": "\ndone\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-1.2",
      "file": "spec/tests/event/after-1.2.tcl",
      "script": "# Test: after negative - negative treated as 0\nputs [after -1]\nputs \"done\"\n",
      "stdout": "\ndone\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-2.0",
      "file": "spec/tests/event/after-2.0.tcl",
      "script": "# Test: after ms script - schedule a timer, returns an ID\nset id [after 100 {set x done}]\nputs [string match \"after#*\" $id]\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-2.1",
      "file": "spec/tests/event/after-2.1.tcl",
      "script": "# Test: after ms script - script is concatenated\nset id [after 100 set x done]\nputs [string match \"after#*\" $id]\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-3.0",
      "file": "spec/tests/event/after-3.0.tcl",
      "script": "# Test: after idle script - schedule idle callback\nset id [after idle {set x done}]\nputs [string match \"after#*\" $id]\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-4.0",
      "file": "spec/tests/event/after-4.0.tcl",
      "script": "# Test: after info - list all pending handlers\nset id1 [after 1000 {set x 1}]\nset id2 [after 2000 {set y 2}]\nset ids [after info]\nputs [expr {[lsearch -exact $ids $id1] \u003e= 0}]\nputs [expr {[lsearch -exact $ids $id2] \u003e= 0}]\nafter cancel $id1\nafter cancel $id2\n",
      "stdout": "1\n1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-4.1",
      "file": "spec/tests/event/after-4.1.tcl",
      "script": "# Test: after info id - get info about specific handler\nset id [after 1000 {set x done}]\nset info [after info $id]\nputs [lindex $info 0]\nputs [lindex $info 1]\nafter cancel $id\n",
      "stdout": "set x done\ntimer\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-4.2",
      "file": "spec/tests/event/after-4.2.tcl",
      "script": "# Test: after info id for idle handler\nset id [after idle {set x done}]\nset info [after info $id]\nputs [lindex $info 0]\nputs [lindex $info 1]\nafter cancel $id\n",
      "stdout": "set x done\nidle\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-5.0",
      "file": "spec/tests/event/after-5.0.tcl",
      "script": "# Test: after cancel id - cancel by ID\nset id [after 1000 {set x done}]\nafter cancel $id\nputs [expr {[lsearch -exact [after info] $id] \u003c 0}]\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-5.1",
      "file": "spec/tests/event/after-5.1.tcl",
      "script": "# Test: after cancel script - cancel by script\nset id [after 1000 {set x done}]\nafter cancel {set x done}\nputs [expr {[lsearch -exact [after info] $id] \u003c 0}]\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-5.2",
      "file": "spec/tests/event/after-5.2.tcl",
      "script": "# Test: after cancel non-existent - should be no-op\nafter cancel nonexistent\nputs \"ok\"\n",
      "stdout": "ok\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-6.0",
      "file": "spec/tests/event/after-6.0.tcl",
      "script": "# Test: after ms script with vwait - timer fires and sets variable\nset done 0\nafter 10 {set done 1}\nvwait done\nputs $done\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-6.1",
      "file": "spec/tests/event/after-6.1.tcl",
      "script": "# Test: after 0 fires quickly\nset done 0\nafter 0 {set done 1}\nvwait done\nputs $done\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-6.2",
      "file": "spec/tests/event/after-6.2.tcl",
      "script": "# Test: after idle executes when event loop is idle\nset done 0\nafter idle {set done 1}\nvwait done\nputs $done\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-7.0",
      "file": "spec/tests/event/after-7.0.tcl",
      "script": "# Test: after - wrong number of args\ncatch {after} result\nputs $result\n",
      "stdout": "wrong # args: should be \"after option ?arg ...?\"\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-7.1",
      "file": "spec/tests/event/after-7.1.tcl",
      "script": "# Test: after - invalid ms\ncatch {after abc} result\nputs $result\n",
      "stdout": "bad argument \"abc\": must be cancel, idle, info, or an integer\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "after-7.2",
      "file": "spec/tests/event/after-7.2.tcl",
      "script": "# Test: after info - invalid id\ncatch {after info nonexistent} result\nputs $result\n",
      "stdout": "event \"nonexistent\" doesn't exist\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-1.0",
      "file": "spec/tests/event/fileevent-1.0.tcl",
      "script": "# Test: fileevent readable - set handler\nset f [open [info script] r]\nfileevent $f readable {set done 1}\nset handler [fileevent $f readable]\nputs [expr {$handler ne \"\"}]\nclose $f\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-1.1",
      "file": "spec/tests/event/fileevent-1.1.tcl",
      "script": "# Test: fileevent readable - get handler\nset f [open [info script] r]\nfileevent $f readable {puts hello}\nputs [fileevent $f readable]\nclose $f\n",
      "stdout": "puts hello\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-1.2",
      "file": "spec/tests/event/fileevent-1.2.tcl",
      "script": "# Test: fileevent readable - clear handler with empty script\nset f [open [info script] r]\nfileevent $f readable {set done 1}\nfileevent $f readable {}\nputs [fileevent $f readable]\nclose $f\n",
      "stdout": "\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-1.3",
      "file": "spec/tests/event/fileevent-1.3.tcl",
      "script": "# Test: fileevent readable - no handler returns empty\nset f [open [info script] r]\nputs [fileevent $f readable]\nclose $f\n",
      "stdout": "\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-2.0",
      "file": "spec/tests/event/fileevent-2.0.tcl",
      "script": "# Test: fileevent writable - set handler\nset f [file tempfile tmp]\nfileevent $f writable {set done 1}\nset handler [fileevent $f writable]\nputs [expr {$handler ne \"\"}]\nclose $f\nfile delete $tmp\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-2.1",
      "file": "spec/tests/event/fileevent-2.1.tcl",
      "script": "# Test: fileevent writable - get handler\nset f [file tempfile tmp]\nfileevent $f writable {puts hello}\nputs [fileevent $f writable]\nclose $f\nfile delete $tmp\n",
      "stdout": "puts hello\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-3.0",
      "file": "spec/tests/event/fileevent-3.0.tcl",
      "script": "# Test: fileevent - wrong number of args\ncatch {fileevent} result\nputs $result\n",
      "stdout": "wrong # args: should be \"fileevent channel event ?script?\"\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-3.1",
      "file": "spec/tests/event/fileevent-3.1.tcl",
      "script": "# Test: fileevent - invalid channel\ncatch {fileevent nonexistent readable} result\nputs $result\n",
      "stdout": "can not find channel named \"nonexistent\"\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "fileevent-3.2",
      "file": "spec/tests/event/fileevent-3.2.tcl",
      "script": "# Test: fileevent - invalid event type\nset f [open [info script] r]\ncatch {fileevent $f invalid} result\nclose $f\nputs $result\n",
      "stdout": "bad event name \"invalid\": must be readable or writable\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "update-1.0",
      "file": "spec/tests/event/update-1.0.tcl",
      "script": "# Test: update - process pending events\nset x 0\nafter 0 {set x 1}\nupdate\nputs $x\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "update-1.1",
      "file": "spec/tests/event/update-1.1.tcl",
      "script": "# Test: update idletasks - process idle callbacks\nset x 0\nafter idle {set x 1}\nupdate idletasks\nputs $x\n",
      "stdout": "1\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "update-1.2",
      "file": "spec/tests/event/update-1.2.tcl",
      "script": "# Test: update returns empty string\nputs [update]\n",
      "stdout": "\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "update-2.0",
      "file": "spec/tests/event/update-2.0.tcl",
      "script": "# Test: update - wrong args\ncatch {update invalid} result\nputs $result\n",
      "stdout": "bad option \"invalid\": must be idletasks\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "vwait-1.0",
      "file": "spec/tests/event/vwait-1.0.tcl",
      "script": "# Test: vwait basic - wait for variable to be set by timer\nset x \"\"\nafter 10 {set x done}\nvwait x\nputs $x\n",
      "stdout": "done\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "vwait-1.1",
      "file": "spec/tests/event/vwait-1.1.tcl",
      "script": "# Test: vwait returns empty string on simple form\nset x \"\"\nafter 10 {set x done}\nputs [vwait x]\n",
      "stdout": "\n",
      "stderr": "",
      "returncode": 0
    },
    {
      "name": "vwait-2.0",
      "file": "spec/tests/event/vwait-2.0.tcl",
      "script": "# Test: vwait - wrong number of args (no args)\ncatch {vwait} result\nputs $result\n",
      "stdout": "\n",
      "stderr": "",
      "returncode": 0
    }
  ]
}