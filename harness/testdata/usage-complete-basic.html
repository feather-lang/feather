<!DOCTYPE html>
<html>
<head>
  <title>Usage Complete - Basic Tests</title>
</head>
<body>

<!-- Basic command completion at position 0 -->
<test id="complete-command-empty">
  <script>
usage for puts {arg &lt;text&gt;}
usage for proc {arg &lt;name&gt;}
usage complete {} 0
  </script>
  <expected>{{text proc type command help {}} {text puts type command help {}}}</expected>
</test>

<!-- Command completion with prefix -->
<test id="complete-command-prefix">
  <script>
usage for puts {arg &lt;text&gt;}
usage for proc {arg &lt;name&gt;}
usage complete {pu} 2
  </script>
  <expected>{{text puts type command help {}}}</expected>
</test>

<!-- Command completion with partial match -->
<test id="complete-command-pr">
  <script>
usage for puts {arg &lt;text&gt;}
usage for proc {arg &lt;name&gt;}
usage for print {arg &lt;msg&gt;}
usage complete {pr} 2
  </script>
  <expected>{{text print type command help {}} {text proc type command help {}}}</expected>
</test>

<!-- No completion in middle of command -->
<test id="complete-no-match-args">
  <script>
usage for puts {arg &lt;text&gt;}
usage complete {puts hello} 10
  </script>
  <expected>{}</expected>
</test>

<!-- Completion at start after whitespace -->
<test id="complete-after-semicolon">
  <script>
usage for puts {arg &lt;text&gt;}
usage for set {arg &lt;var&gt; arg &lt;value&gt;}
usage complete {puts hello; se} 14
  </script>
  <expected>{{text set type command help {}}}</expected>
</test>

<!-- Completion with help text -->
<test id="complete-with-help">
  <script>
usage for test {
  arg &lt;file&gt;
  help {Check if file exists}
}
usage complete {te} 2
  </script>
  <expected>{{text test type command help {Check if file exists}}}</expected>
</test>

<!-- Empty prefix matches all -->
<test id="complete-empty-prefix-matches-all">
  <script>
usage for cmd1 {}
usage for cmd2 {}
set result [usage complete {} 0]
expr {[llength $result] == 2}
  </script>
  <expected>1</expected>
</test>

<!-- Case sensitive matching -->
<test id="complete-case-sensitive">
  <script>
usage for Puts {arg &lt;text&gt;}
usage for puts {arg &lt;text&gt;}
usage complete {P} 1
  </script>
  <expected>{{text Puts type command help {}}}</expected>
</test>

<!-- Completion at end of script -->
<test id="complete-at-end">
  <script>
usage for puts {arg &lt;text&gt;}
set script {pu}
usage complete $script [string length $script]
  </script>
  <expected>{{text puts type command help {}}}</expected>
</test>

<!-- Position beyond script length is clamped -->
<test id="complete-position-beyond-end">
  <script>
usage for puts {arg &lt;text&gt;}
usage complete {pu} 1000
  </script>
  <expected>{{text puts type command help {}}}</expected>
</test>

</body>
</html>
