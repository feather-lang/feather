<!DOCTYPE html>
<html>
<head>
  <title>Usage Complete - Advanced Tests</title>
</head>
<body>

<!-- Subcommand completion tests -->
<test id="complete-subcommand-empty-prefix">
  <script>
usage for git {
  cmd clone {arg &lt;repo&gt;}
  cmd commit {arg &lt;msg&gt;}
  cmd checkout {arg &lt;branch&gt;}
}
usage complete {git } 4
  </script>
  <expected>{{text checkout type subcommand help {}} {text clone type subcommand help {}} {text commit type subcommand help {}}}</expected>
</test>

<test id="complete-subcommand-with-prefix">
  <script>
usage for git {
  cmd clone {arg &lt;repo&gt;}
  cmd commit {arg &lt;msg&gt;}
  cmd checkout {arg &lt;branch&gt;}
}
usage complete {git co} 6
  </script>
  <expected>{{text commit type subcommand help {}} {text checkout type subcommand help {}}}</expected>
</test>

<test id="complete-subcommand-with-help">
  <script>
usage for git {
  cmd clone {
    arg &lt;repo&gt;
    help {Clone a repository}
  }
  cmd commit {
    arg &lt;msg&gt;
    help {Create a commit}
  }
}
usage complete {git cl} 6
  </script>
  <expected>{{text clone type subcommand help {Clone a repository}}}</expected>
</test>

<!-- Flag completion tests -->
<test id="complete-flags-no-subcommands">
  <script>
usage for compile {
  arg &lt;source&gt;
  flag --verbose {help {Enable verbose output}}
  flag -O --optimize ?level? {help {Optimization level}}
}
usage complete {compile file.c } 15
  </script>
  <expected>{{text -O type flag help {Optimization level}} {text --optimize type flag help {Optimization level}} {text --verbose type flag help {Enable verbose output}}}</expected>
</test>

<test id="complete-flags-with-dash-prefix">
  <script>
usage for compile {
  arg &lt;source&gt;
  flag --verbose
  flag -O --optimize
}
usage complete {compile file.c -} 16
  </script>
  <expected>{{text -O type flag help {}} {text --optimize type flag help {}} {text --verbose type flag help {}}}</expected>
</test>

<test id="complete-flags-with-long-prefix">
  <script>
usage for compile {
  arg &lt;source&gt;
  flag --verbose
  flag --version
  flag -O --optimize
}
usage complete {compile file.c --ver} 20
  </script>
  <expected>{{text --verbose type flag help {}} {text --version type flag help {}}}</expected>
</test>

<test id="complete-flags-subcommand">
  <script>
usage for git {
  cmd commit {
    flag -m --message &lt;msg&gt; {help {Commit message}}
    flag -a --all {help {Stage all changes}}
  }
}
usage complete {git commit } 11
  </script>
  <expected>{{text -a type flag help {Stage all changes}} {text -m type flag help {Commit message}} {text --all type flag help {Stage all changes}} {text --message type flag help {Commit message}}}</expected>
</test>

<test id="complete-flags-subcommand-prefix">
  <script>
usage for git {
  cmd commit {
    flag -m --message &lt;msg&gt;
    flag -a --all
  }
}
usage complete {git commit -a} 13
  </script>
  <expected>{{text -a type flag help {}} {text --all type flag help {}}}</expected>
</test>

<!-- Hide flag test -->
<test id="complete-no-hidden-subcommands">
  <script>
usage for git {
  cmd clone {arg &lt;repo&gt;}
  cmd internal {
    arg &lt;cmd&gt;
    hide
  }
  cmd commit {arg &lt;msg&gt;}
}
usage complete {git } 4
  </script>
  <expected>{{text clone type subcommand help {}} {text commit type subcommand help {}}}</expected>
</test>

<test id="complete-no-hidden-flags">
  <script>
usage for cmd {
  flag --verbose
  flag --debug {hide}
  flag --quiet
}
usage complete {cmd } 4
  </script>
  <expected>{{text --quiet type flag help {}} {text --verbose type flag help {}}}</expected>
</test>

<!-- Mixed command and no-spec scenarios -->
<test id="complete-unknown-command-no-results">
  <script>
usage for puts {arg &lt;text&gt;}
usage complete {undefined } 10
  </script>
  <expected>{}</expected>
</test>

<test id="complete-after-subcommand-with-args">
  <script>
usage for git {
  cmd commit {
    arg &lt;msg&gt;
    flag -a --all
  }
}
usage complete {git commit "my message" } 24
  </script>
  <expected>{{text -a type flag help {}} {text --all type flag help {}}}</expected>
</test>

<!-- Spec order preserved for subcommands -->
<test id="complete-subcommand-spec-order">
  <script>
usage for test {
  cmd zebra {arg &lt;x&gt;}
  cmd apple {arg &lt;y&gt;}
  cmd banana {arg &lt;z&gt;}
}
set result [usage complete {test } 5]
# Check that order is preserved (not alphabetical)
list [lindex [lindex $result 0] 1] \
     [lindex [lindex $result 1] 1] \
     [lindex [lindex $result 2] 1]
  </script>
  <expected>zebra apple banana</expected>
</test>

<!-- Short flag only -->
<test id="complete-short-flag-only">
  <script>
usage for cmd {
  flag -v {help {Verbose mode}}
}
usage complete {cmd -} 5
  </script>
  <expected>{{text -v type flag help {Verbose mode}}}</expected>
</test>

<!-- Long flag only -->
<test id="complete-long-flag-only">
  <script>
usage for cmd {
  flag --verbose {help {Verbose mode}}
}
usage complete {cmd --} 6
  </script>
  <expected>{{text --verbose type flag help {Verbose mode}}}</expected>
</test>

</body>
</html>
